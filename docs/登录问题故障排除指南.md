# 微信授权登录问题故障排除指南

## 常见问题及解决方案

### 1. 云开发环境配置问题

**症状**: 点击登录按钮后出现网络错误或云函数调用失败

**解决方案**:
1. 检查 `config/index.js` 中的云开发环境ID是否正确
2. 在微信开发者工具中打开云开发控制台
3. 确认环境ID与配置文件中的一致

```javascript
// config/index.js
cloud: {
  env: 'your-cloud-env-id', // 替换为实际的环境ID
  debug: true,
  timeout: 10000
}
```

### 2. 云函数未部署或部署失败

**症状**: 控制台显示 "云函数不存在" 或 404 错误

**解决方案**:
1. 运行检查脚本: `node scripts/deploy-cloud-functions.js`
2. 在微信开发者工具中右键 `cloudfunctions` 文件夹
3. 选择 "上传并部署：云端安装依赖"
4. 等待所有云函数部署完成

### 3. 网络连接问题

**症状**: 请求超时或网络连接失败

**解决方案**:
1. 检查网络连接
2. 在微信开发者工具中检查代理设置
3. 尝试切换网络环境

### 4. AppID配置问题

**症状**: 无法获取用户OpenID

**解决方案**:
1. 检查 `project.config.json` 中的 appid 是否正确
2. 确认小程序已在微信公众平台注册
3. 检查云开发服务是否已开通

### 5. 基础库版本问题

**症状**: 提示 "请使用 2.2.3 或以上的基础库"

**解决方案**:
1. 在微信开发者工具中调整基础库版本
2. 建议使用 3.0.0 以上版本

## 调试步骤

### 1. 检查控制台日志
打开微信开发者工具的控制台，查看详细错误信息：
- 网络请求错误
- 云函数调用错误
- JavaScript 运行错误

### 2. 测试云开发连接
在控制台中运行以下代码测试云开发连接：

```javascript
wx.cloud.callFunction({
  name: 'user_service',
  data: { action: 'test' },
  success: console.log,
  fail: console.error
})
```

### 3. 检查用户授权状态
```javascript
wx.getSetting({
  success: (res) => {
    console.log('用户授权状态:', res.authSetting)
  }
})
```

### 4. 清除缓存重试
1. 在微信开发者工具中点击 "清缓存" -> "清除数据缓存"
2. 重新编译项目
3. 重新测试登录功能

## 预防措施

### 1. 定期检查云函数状态
- 在云开发控制台中查看云函数运行日志
- 监控云函数调用次数和错误率

### 2. 备份重要配置
- 定期备份 `project.config.json`
- 记录云开发环境ID和相关配置

### 3. 版本控制
- 使用 Git 管理代码版本
- 在部署前进行充分测试

## 联系支持

如果以上方案都无法解决问题，请：
1. 收集详细的错误日志
2. 记录复现步骤
3. 联系技术支持团队

## 更新日志

- 2024-01-XX: 初始版本
- 增加了网络检查和错误处理
- 优化了云函数调用逻辑
