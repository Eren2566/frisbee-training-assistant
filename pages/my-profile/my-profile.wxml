<!--pages/my-profile/my-profile.wxml-->
<view class="page">
  <!-- å·²ç™»å½•çŠ¶æ€ -->
  <view wx:if="{{isLoggedIn}}">
    <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
    <view class="card user-card">
      <view class="user-info">
        <image class="avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
        <view class="user-details">
          <text class="nickname">{{userInfo.nickName}}</text>
          <view class="role-badge {{userInfo.role}}">
            <text>{{userInfo.role === 'admin' ? 'é˜Ÿé•¿' : 'é˜Ÿå‘˜'}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç»Ÿè®¡æ•°æ® -->
    <view class="card stats-card">
      <text class="card-title">å‡ºå‹¤ç»Ÿè®¡</text>
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-number">{{stats.totalEvents}}</text>
          <text class="stat-label">å‚ä¸è®­ç»ƒ</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{stats.attendedEvents}}</text>
          <text class="stat-label">å®é™…å‡ºå‹¤</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{stats.attendanceRate}}%</text>
          <text class="stat-label">å‡ºå‹¤ç‡</text>
        </view>
      </view>
    </view>

    <!-- æˆ‘çš„è®­ç»ƒè®°å½• -->
    <view class="card">
      <text class="card-title">æˆ‘çš„è®­ç»ƒè®°å½•</text>
      
      <!-- åŠ è½½çŠ¶æ€ -->
      <view class="loading-state" wx:if="{{isLoading}}">
        <text class="loading-text">åŠ è½½ä¸­...</text>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:elif="{{myRegistrations.length === 0}}">
        <view class="empty-icon">ğŸ“</view>
        <text class="empty-text">æš‚æ— è®­ç»ƒè®°å½•</text>
      </view>

      <!-- è®°å½•åˆ—è¡¨ -->
      <view class="registration-list" wx:else>
        <view class="registration-item" 
              wx:for="{{myRegistrations}}" 
              wx:key="_id"
              bindtap="goToEventDetail"
              data-event-id="{{item.eventId}}">
          
          <view class="registration-header">
            <text class="event-title">{{item.eventInfo.title}}</text>
            <view class="status-badge {{item.status}}">
              <text>{{item.status === 'signed_up' ? 'å·²æŠ¥å' : item.status === 'leave_requested' ? 'å·²è¯·å‡' : item.status === 'present' ? 'å·²å‡ºå‹¤' : item.status === 'absent' ? 'ç¼ºå‹¤' : 'æœªçŸ¥'}}</text>
            </view>
          </view>

          <view class="registration-info">
            <view class="info-item">
              <text class="info-icon">ğŸ•</text>
              <text class="info-text">{{item.eventInfo.eventTime}}</text>
            </view>
            <view class="info-item">
              <text class="info-icon">ğŸ“</text>
              <text class="info-text">{{item.eventInfo.location}}</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="actions">
      <button class="btn-danger logout-btn" bindtap="logout">é€€å‡ºç™»å½•</button>
    </view>
  </view>

  <!-- æœªç™»å½•çŠ¶æ€ -->
  <view class="login-prompt" wx:else>
    <view class="prompt-content">
      <view class="prompt-icon">ğŸ‘¤</view>
      <text class="prompt-title">è¯·å…ˆç™»å½•</text>
      <text class="prompt-desc">ç™»å½•åå¯æŸ¥çœ‹ä¸ªäººå‡ºå‹¤è®°å½•</text>
      <button class="btn-primary" bindtap="goToLogin">ç«‹å³ç™»å½•</button>
    </view>
  </view>
</view>
