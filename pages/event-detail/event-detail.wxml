<!--pages/event-detail/event-detail.wxml-->
<view class="page">
  <!-- è®­ç»ƒè¯¦æƒ…å¡ç‰‡ -->
  <view class="card event-detail-card" wx:if="{{eventDetail}}">
    <!-- è®­ç»ƒæ ‡é¢˜å’ŒçŠ¶æ€ -->
    <view class="event-header">
      <text class="event-title">{{eventDetail.title}}</text>
      <view class="event-status {{eventDetail.status}}">
        <text>{{eventDetail.status === 'registering' ? 'æŠ¥åä¸­' : 'å·²ç»“æŸ'}}</text>
      </view>
    </view>

    <!-- è®­ç»ƒåŸºæœ¬ä¿¡æ¯ -->
    <view class="event-info">
      <view class="info-item">
        <text class="info-icon">ğŸ•</text>
        <text class="info-label">è®­ç»ƒæ—¶é—´</text>
        <text class="info-value">{{eventDetail.eventTime}}</text>
      </view>
      
      <view class="info-item">
        <text class="info-icon">ğŸ“</text>
        <text class="info-label">è®­ç»ƒåœ°ç‚¹</text>
        <text class="info-value">{{eventDetail.location}}</text>
      </view>
    </view>

    <!-- è®­ç»ƒå†…å®¹ -->
    <view class="event-content" wx:if="{{eventDetail.content}}">
      <text class="content-title">è®­ç»ƒå†…å®¹</text>
      <text class="content-text">{{eventDetail.content}}</text>
    </view>

    <!-- å¤‡æ³¨ä¿¡æ¯ -->
    <view class="event-notes" wx:if="{{eventDetail.notes}}">
      <text class="notes-title">å¤‡æ³¨</text>
      <text class="notes-text">{{eventDetail.notes}}</text>
    </view>
  </view>

  <!-- ç”¨æˆ·æ“ä½œåŒºåŸŸ -->
  <view class="card user-actions" wx:if="{{!isAdmin && eventDetail && eventDetail.status === 'registering'}}">
    <text class="section-title">æˆ‘çš„çŠ¶æ€</text>
    
    <!-- ç”¨æˆ·å½“å‰çŠ¶æ€æ˜¾ç¤º -->
    <view class="current-status" wx:if="{{userStatus}}">
      <text class="status-text">å½“å‰çŠ¶æ€ï¼š</text>
      <view class="status-badge {{userStatus.status}}">
        <text>{{userStatus.status === 'signed_up' ? 'å·²æŠ¥å' : userStatus.status === 'leave_requested' ? 'å·²è¯·å‡' : 'æœªçŸ¥'}}</text>
      </view>
    </view>

    <!-- æ“ä½œæŒ‰é’® -->
    <view class="action-buttons" wx:if="{{!userStatus}}">
      <button 
        class="btn-primary register-btn" 
        bindtap="registerForEvent"
        data-status="signed_up"
        disabled="{{isRegistering}}"
      >
        {{isRegistering ? 'å¤„ç†ä¸­...' : 'æˆ‘è¦æŠ¥å'}}
      </button>
      
      <button 
        class="btn-secondary leave-btn" 
        bindtap="registerForEvent"
        data-status="leave_requested"
        disabled="{{isRegistering}}"
      >
        {{isRegistering ? 'å¤„ç†ä¸­...' : 'æˆ‘è¦è¯·å‡'}}
      </button>
    </view>
  </view>

  <!-- ç®¡ç†å‘˜æŠ¥åç®¡ç†åŒºåŸŸ -->
  <view class="card admin-panel" wx:if="{{isAdmin}}">
    <text class="section-title">æŠ¥åç®¡ç†</text>
    
    <!-- æŠ¥åç»Ÿè®¡ -->
    <view class="registration-stats">
      <view class="stat-item">
        <text class="stat-number">{{registrationStats.total}}</text>
        <text class="stat-label">æ€»æŠ¥å</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{registrationStats.signedUp}}</text>
        <text class="stat-label">å·²æŠ¥å</text>
      </view>
      <view class="stat-item">
        <text class="stat-number">{{registrationStats.leaveRequested}}</text>
        <text class="stat-label">å·²è¯·å‡</text>
      </view>
    </view>

    <!-- æŠ¥ååˆ—è¡¨ -->
    <view class="registration-list" wx:if="{{registrationList.length > 0}}">
      <view class="list-item" 
            wx:for="{{registrationList}}" 
            wx:key="_id">
        
        <view class="member-info">
          <image class="member-avatar" src="{{item.userInfo.avatarUrl}}" mode="aspectFill"></image>
          <view class="member-details">
            <text class="member-name">{{item.userInfo.nickName}}</text>
            <view class="member-status {{item.status}}">
              <text>{{item.status === 'signed_up' ? 'å·²æŠ¥å' : item.status === 'leave_requested' ? 'å·²è¯·å‡' : item.status === 'present' ? 'å·²å‡ºå‹¤' : item.status === 'absent' ? 'ç¼ºå‹¤' : 'æœªçŸ¥'}}</text>
            </view>
          </view>
        </view>

        <!-- ç®¡ç†å‘˜æ“ä½œæŒ‰é’® -->
        <view class="admin-actions" wx:if="{{item.status === 'signed_up'}}">
          <button 
            class="btn-mini btn-success" 
            bindtap="updateAttendance"
            data-id="{{item._id}}"
            data-status="present"
          >
            å‡ºå‹¤
          </button>
          <button 
            class="btn-mini btn-danger" 
            bindtap="updateAttendance"
            data-id="{{item._id}}"
            data-status="absent"
          >
            ç¼ºå‹¤
          </button>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-registration" wx:else>
      <text class="empty-text">æš‚æ— æŠ¥åè®°å½•</text>
    </view>
  </view>
</view>
