# 飞盘队训练助手 - 部署指南

## 🚀 快速部署步骤

### 第一步：获取微信小程序 AppID

1. 访问 [微信公众平台](https://mp.weixin.qq.com/)
2. 注册并创建小程序
3. 在"开发" -> "开发管理" -> "开发设置"中获取 AppID

### 第二步：配置项目

1. **修改项目配置文件**
   ```json
   // project.config.json
   {
     "appid": "你的AppID", // 替换这里
     // ... 其他配置保持不变
   }
   ```

2. **配置云开发环境**
   - 打开微信开发者工具
   - 导入项目（选择当前目录）
   - 点击"云开发"按钮，开通云开发服务
   - 记录下环境ID（格式如：cloud1-xxx）

3. **修改云开发配置**
   ```javascript
   // app.js 第12行
   env: '你的云开发环境ID', // 替换这里
   ```

### 第三步：创建数据库集合

在微信开发者工具的"云开发控制台" -> "数据库"中创建以下集合：

1. **Users 集合**
   - 集合名称：`Users`
   - 权限设置：所有用户可读，仅创建者可读写
   - 字段：`_openid`, `nickName`, `avatarUrl`, `role`, `gender`, `institute`, `discName`, `contactInfo`, `createTime`

2. **Events 集合**
   - 集合名称：`Events`
   - 权限设置：所有用户可读，仅管理员可写
   - 字段：`_id`, `creatorId`, `title`, `eventTime`, `location`, `content`, `notes`, `status`, `createTime`, `updateTime`

3. **Registrations 集合**
   - 集合名称：`Registrations`
   - 权限设置：所有用户可读，仅创建者可读写
   - 字段：`_id`, `eventId`, `userId`, `status`, `createTime`, `updateTime`

> 💡 **提示**: 可以使用 `scripts/init-database.js` 脚本快速初始化数据库结构

### 第四步：部署云函数

在微信开发者工具中，右键以下云函数目录，选择"上传并部署（所有文件）"：

1. `cloudfunctions/user_service` - 用户认证和管理
2. `cloudfunctions/event_service` - 训练活动管理
3. `cloudfunctions/registration_service` - 报名出勤管理
4. `cloudfunctions/analytics_service` - 数据统计分析
5. `cloudfunctions/system_service` - 系统管理维护
6. `cloudfunctions/error_reporter` - 错误监控上报

> 💡 **提示**: 可以右键 `cloudfunctions` 文件夹选择"上传并部署：云端安装依赖"一次性部署所有云函数

### 第五步：验证图标资源

项目已包含TabBar所需的图标文件（位于 `images/` 目录）：

- `home.png` / `home-active.png` - 首页图标
- `event.png` / `event-active.png` - 训练图标
- `profile.png` / `profile-active.png` - 个人中心图标

> ✅ **已完成**: 图标文件已包含在项目中，无需额外添加

### 第六步：设置管理员权限

1. 编译并运行小程序
2. 使用你的微信号登录一次
3. 在云开发控制台的"数据库" -> "Users"集合中
4. 找到你的用户记录，将 `role` 字段从 `member` 改为 `admin`

## ✅ 验证部署

### 基础功能验证
- [ ] 小程序能正常编译运行
- [ ] 用户能成功登录
- [ ] 数据库集合已创建
- [ ] 云函数部署成功

### 队员功能验证
- [ ] 查看训练列表
- [ ] 查看训练详情
- [ ] 报名/请假功能
- [ ] 个人出勤记录

### 管理员功能验证
- [ ] 创建训练活动
- [ ] 查看报名列表
- [ ] 确认出勤功能
- [ ] 管理界面权限

## 🔧 常见问题解决

### 1. 云函数调用失败
**问题**: 提示"云函数不存在"或调用超时
**解决**: 
- 检查云函数是否正确部署
- 确认云开发环境ID配置正确
- 查看云函数日志排查错误

### 2. 数据库权限错误
**问题**: 提示"没有权限访问数据库"
**解决**:
- 检查数据库集合权限设置
- 确认用户已正确登录
- 验证openid获取是否正常

### 3. 图标不显示
**问题**: TabBar图标显示异常
**解决**:
- 检查图标文件路径是否正确
- 确认图标文件格式和尺寸
- 可以暂时注释掉app.json中的tabBar配置

### 4. 管理员功能无法使用
**问题**: 创建训练等功能提示权限不足
**解决**:
- 确认已将用户role设置为admin
- 检查云函数中的权限验证逻辑
- 清除小程序缓存重新登录

## 📱 测试建议

### 多用户测试
1. 使用不同微信号测试队员功能
2. 验证管理员和普通用户的权限区分
3. 测试报名、出勤等业务流程

### 边界情况测试
1. 网络异常情况处理
2. 重复操作防护
3. 数据验证和错误提示

## 🎯 上线准备

### 代码优化
- [ ] 移除console.log调试信息
- [ ] 优化加载性能
- [ ] 完善错误处理

### 审核准备
- [ ] 完善小程序信息
- [ ] 准备审核资料
- [ ] 设置服务类目

### 发布流程
1. 在开发者工具中点击"上传"
2. 填写版本信息和更新说明
3. 在微信公众平台提交审核
4. 审核通过后发布上线

## 📞 技术支持

如果在部署过程中遇到问题，可以：
1. 查看微信开发者工具的调试信息
2. 检查云开发控制台的日志
3. 参考微信小程序官方文档
4. 联系开发团队获取支持

---

**祝您部署顺利！🎉**
